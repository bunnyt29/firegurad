<google-map #gmap [options]="options" style="height:100vh;width:100vw"></google-map>

<ng-template #infoWindowTpl let-item="item" let-position="position">
  <div class="iw-card">
    <div class="iw-body">
      <div class="iw-row">
        <span class="iw-bullet">
          <img src="/mobile/iw-bullet-icon.svg" />
        </span>
        <span class="iw-label">Местоположение</span>
        <span class="iw-value">{{ item.area }}</span>
      </div>

      <div class="iw-row">
        <span class="iw-bullet">
          <img src="/mobile/iw-bullet-icon.svg" />
        </span>
        <span class="iw-label">Координати</span>
        <span class="iw-value">
          {{ item.address || (position.lat.toFixed(4) + ', Lng: ' + position.lng.toFixed(4)) }}
        </span>
      </div>

      <div class="iw-row">
        <span class="iw-bullet">
          <img src="/mobile/iw-bullet-icon.svg" />
        </span>
        <span class="iw-label">Източник</span>
        <span class="iw-value" [class.iw-danger]="item.isActive">
          @switch (item.source) {
            @case ('FIRE_DEPARTMENT') { пожарна }
            @case ('NASA_SATELLITE') { НАСА сателит }
            @default { {{ item.source }} }
          }
        </span>
      </div>

      <div class="iw-row">
        <span class="iw-bullet">
          <img src="/mobile/iw-bullet-icon.svg" />
        </span>
        <span class="iw-label">Потвърден</span>
        <span class="iw-value" [class.iw-danger]="item.isActive">
          {{ item.isConfirmed ? 'Да' : 'Не' }}
        </span>
      </div>

      <div class="iw-row">
        <span class="iw-bullet">
          <img src="/mobile/iw-bullet-icon.svg" alt="" />
        </span>
              <span class="iw-label">Доброволци</span>
              <span class="iw-value">
          @if (!item.attendanceLoading) {
            <span class="pill">Сертифицирани: {{ item.certifiedCount ?? 0 }}</span>
            <span class="pill pill-muted">Несертифицирани: {{ item.notCertifiedCount ?? 0 }}</span>
            <span class="pill pill-total">Общо: {{ item.volunteersLabel || 0 }}</span>
          } @else {
            <span>зарежда…</span>
          }
        </span>
      </div>


      @if(isLogged()){
        <button class="iw-btn" (click)="goTo(item)">Добави ме!</button>
      }
    </div>
  </div>
</ng-template>
